<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>For You ❤️</title>
<style>
html,body{
  margin:0;
  padding:0;
  overflow:hidden;
  background:black;
}
canvas{
  position:absolute;
  top:0;left:0;
}
#text{
  position:absolute;
  top:40%;
  width:100%;
  text-align:center;
  font-size:42px;
  color:#ff9acb;
  font-family:"微软雅黑";
  opacity:0;
  transition:opacity 1s;
  text-shadow:0 0 15px pink;
}
.fadeout{
  animation:fade 3s forwards;
}
@keyframes fade{
  to{opacity:0;}
}
</style>
</head>
<body>
<canvas id="c"></canvas>
<div id="text"></div>

<audio id="bgm" loop>
  <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_aa1b2a1e4b.mp3?filename=romantic-ambient-113397.mp3" type="audio/mpeg">
</audio>

<script>
const canvas=document.getElementById("c");
const ctx=canvas.getContext("2d");
canvas.width=window.innerWidth;
canvas.height=window.innerHeight;

let particles=[];
let mode="normal"; // normal or heart

function heartShape(t){
  return {
    x:16*Math.pow(Math.sin(t),3),
    y:-(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t))
  };
}

function Firework(){
  this.x=Math.random()*canvas.width;
  this.y=canvas.height;
  this.targetY=Math.random()*canvas.height/2+100;
  this.exploded=false;
  this.color=`hsl(${Math.random()*360},100%,60%)`;
}

Firework.prototype.update=function(){
  this.y-=5;
  if(this.y<=this.targetY && !this.exploded){
    this.exploded=true;
    if(mode==="heart"){
      for(let i=0;i<120;i++){
        let t=Math.random()*Math.PI*2;
        let p=heartShape(t);
        particles.push({
          x:this.x,y:this.y,
          vx:p.x*0.3,
          vy:p.y*0.3,
          life:100,
          color:"pink"
        });
      }
    }else{
      for(let i=0;i<80;i++){
        particles.push({
          x:this.x,y:this.y,
          vx:(Math.random()-0.5)*8,
          vy:(Math.random()-0.5)*8,
          life:80,
          color:this.color
        });
      }
    }
  }
}

let fireworks=[];

function animate(){
  ctx.fillStyle="rgba(0,0,0,0.2)";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  if(Math.random()<0.05){
    fireworks.push(new Firework());
  }

  fireworks.forEach(f=>f.update());

  particles.forEach((p,i)=>{
    p.x+=p.vx;
    p.y+=p.vy;
    p.life--;
    ctx.beginPath();
    ctx.arc(p.x,p.y,2,0,Math.PI*2);
    ctx.fillStyle=p.color;
    ctx.fill();
    if(p.life<=0) particles.splice(i,1);
  });

  requestAnimationFrame(animate);
}
animate();

// 文字顺序
const text=document.getElementById("text");

function showText(content){
  text.style.opacity=0;
  setTimeout(()=>{
    text.innerText=content;
    text.style.opacity=1;
  },500);
}

setTimeout(()=>{ showText("嘉晗，你知道吗？"); },1000);
setTimeout(()=>{ showText("我仍然好爱你！"); },5000);
setTimeout(()=>{ showText("如果能够再来一次...."); },9000);

// 切换成心形烟花
setTimeout(()=>{
  mode="heart";
  showText("我们好好相爱吧！");
},13000);

// 30秒结束
setTimeout(()=>{
  document.body.classList.add("fadeout");
},27000);

// 音乐点击播放（浏览器限制）
document.body.addEventListener("click",()=>{
  document.getElementById("bgm").play();
},{once:true});
</script>
</body>
</html>
